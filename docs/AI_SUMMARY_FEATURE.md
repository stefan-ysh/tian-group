# AI 论文总结功能

这是一个基于大语言模型的论文自动总结功能，可以帮助用户快速了解论文的核心内容。

## 功能特点

### 1. 智能内容提取
- 自动从 Markdown 文件中提取论文全文
- 支持从摘要（abstract）生成总结
- 支持仅从标题和元数据生成概述
- 智能清理和处理 Markdown 格式

### 2. 流式响应
- 实时显示 AI 生成的内容
- 用户可以随时取消请求
- 平滑的自动滚动体验

### 3. 缓存机制
- 24小时缓存已生成的总结
- 减少 API 调用次数
- 提升用户体验速度

### 4. 国际化支持
- 完整的中英文界面
- 根据语言环境调整 AI 提示词
- 专业的学术语言输出

### 5. 错误处理
- 完善的错误提示
- 自动重试功能
- 网络中断恢复

## 技术实现

### 前端组件
- **位置**: `src/components/widgets/PublicationItem.tsx`
- **功能**: 
  - 显示论文卡片
  - AI 总结按钮
  - 弹窗显示总结内容
  - 流式内容渲染
  - Markdown/LaTeX 数学公式支持

### API 路由
- **位置**: `app/api/publications/summary/route.ts`
- **功能**:
  - 接收请求并验证参数
  - 获取论文内容
  - 调用 AI API
  - 处理流式响应
  - 缓存管理

### 工具函数
- **位置**: `src/utils/markdown.ts`
- **功能**:
  - Markdown 内容清理
  - 内容验证
  - 文本标准化

## 环境配置

在 `.env.local` 文件中配置以下环境变量：

```bash
# AI API 配置
NEXT_PUBLIC_SILICONFLOW_BASE_URL=https://api.siliconflow.cn
NEXT_PUBLIC_SILICONFLOW_API=your_api_key_here
NEXT_PUBLIC_MODEL=Qwen/Qwen2.5-7B-Instruct
```

### 获取 API Key

1. 访问 [硅基流动](https://siliconflow.cn) 或其他兼容 OpenAI 的 API 提供商
2. 注册账号并获取 API Key
3. 将 Key 填入 `.env.local` 文件

## 使用说明

### 用户界面

1. 在论文列表页面，每篇论文卡片右下角有一个魔法棒图标 (🪄)
2. 点击图标即可生成 AI 总结
3. 总结会在弹窗中以流式方式显示
4. 可以随时点击关闭或取消按钮

### API 调用

```typescript
// POST /api/publications/summary
{
  "slug": "paper-slug",           // 论文标识符
  "locale": "zh",                 // 语言 (zh/en)
  "stream": true,                 // 启用流式响应
  "useCache": true,               // 使用缓存
  "contextInfo": {                // 可选的上下文信息
    "authors": ["Author 1"],
    "journal": "Journal Name",
    "publishDate": "2024-01-01"
  }
}
```

## AI 提示词设计

### 中文提示词
强调：
- 完全使用中文
- 学术化书面语
- 分条目清晰列出
- 专业术语首次出现时标注英文
- 禁止中英文混杂

### 英文提示词
强调：
- 学术现在时态
- 使用项目符号提高可读性
- 保留技术术语但需解释
- 禁止主观表述

## 优化建议

### 已实现的优化
✅ 流式响应
✅ 缓存机制
✅ 错误处理和重试
✅ 国际化支持
✅ 取消请求功能
✅ Markdown 内容清理
✅ LaTeX 数学公式渲染

### 可能的未来优化
- [ ] 添加总结内容的导出功能（PDF/Word）
- [ ] 支持自定义 AI 模型选择
- [ ] 添加总结质量评分
- [ ] 支持批量生成总结
- [ ] 添加总结历史记录
- [ ] 支持用户反馈和纠错

## 性能考虑

1. **缓存策略**: 24小时缓存减少重复请求
2. **内容限制**: Markdown 内容最大 8000 字符
3. **流式传输**: 边生成边显示，提升用户体验
4. **错误处理**: 完善的异常捕获和用户提示

## 安全性

1. API Key 通过环境变量管理，不暴露在客户端
2. 请求验证确保必要参数存在
3. 内容验证防止恶意输入
4. CORS 和请求头安全设置

## 故障排除

### 问题：总结生成失败
- 检查 API Key 是否正确配置
- 检查网络连接
- 查看浏览器控制台和服务器日志

### 问题：内容显示不完整
- 检查 Markdown 文件格式
- 查看内容长度是否超过限制
- 检查流式传输是否被中断

### 问题：缓存未生效
- 确认 `useCache` 参数为 true
- 检查 `slug` 和 `locale` 是否一致
- 清除缓存后重试

## 开发者注意事项

1. 修改 AI 提示词时要测试中英文两个版本
2. 流式响应需要正确处理编码和解码
3. 缓存 key 的生成要考虑所有相关参数
4. 错误信息要对用户友好且便于调试

## License

此功能遵循项目整体的开源协议。

---

**最后更新**: 2025-10-11
